<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Tareas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-container, .task-list-container {
            margin-bottom: 30px;
        }
        label {
            display: inline-block;
            width: 150px;
            margin-bottom: 10px;
        }
        select, input[type="text"] {
            width: 200px;
            padding: 5px;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #score {
            width: 100px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <!-- Formulario para nueva tarea -->
    <div class="form-container">
        <h2>Agregar Nueva Tarea</h2>
        <form id="taskForm">
            <label for="description">Descripcion de Tarea:</label>
            <input type="text" id="description" required><br>

            <label for="asap">ASAP:</label>
            <select id="asap" required>
                <option value="100">100 (Muy Urgente)</option>
                <option value="50">50 (Moderado)</option>
                <option value="10">10 (Baja Urgencia)</option>
            </select><br>

            <label for="impact">Impacto:</label>
            <select id="impact" required>
                <option value="3">3 (Alto)</option>
                <option value="2">2 (Moderado)</option>
                <option value="1">1 (Bajo)</option>
            </select><br>

            <label for="difficulty">Dificultad:</label>
            <select id="difficulty" required>
                <option value="3">3 (Alta)</option>
                <option value="2">2 (Moderada)</option>
                <option value="1">1 (Baja)</option>
            </select><br>

            <label for="time">Tiempo:</label>
            <select id="time" required>
                <option value="3">3 (Mucho)</option>
                <option value="2">2 (Moderado)</option>
                <option value="1">1 (Poco)</option>
            </select><br>

            <label for="score">Puntaje:</label>
            <input type="text" id="score" readonly><br>

            <label for="status">Estatus:</label>
            <input type="text" id="status" value="No Realizado" readonly><br>

            <button type="submit">Guardar Tarea</button>
        </form>
    </div>

    <!-- Lista de tareas -->
    <div class="task-list-container">
        <h2>Tareas Pendientes</h2>
        <table id="taskTable">
            <thead>
                <tr>
                    <th>description</th>
                    <th>asap</th>
                    <th>impact</th>
                    <th>difficulty</th>
                    <th>time</th>
                    <th>score</th>
                    <th>status</th>
                    <th>action</th>
                </tr>
            </thead>
            <tbody id="taskList"></tbody>
        </table>
        <button id="saveChanges">Guardar Cambios</button>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyPAnDlt7TMs14qVEL2YWwFLuAWQOeaYuzgip3PyjZSmRZvipU8BWuopXlslzQfUCHSZA/exec'; // Reemplaza con la URL del Apps Script
        let tasks = [];

        // Calcular puntaje
        function calculateScore(asap, impact, difficulty, time) {
            return parseInt(asap) + (parseInt(impact) * 10) + (parseInt(difficulty) * 5) + (parseInt(time) * 5);
        }

        // Actualizar puntaje en tiempo real
        document.querySelectorAll('#asap, #impact, #difficulty, #time').forEach(input => {
            input.addEventListener('change', () => {
                const asap = document.getElementById('asap').value;
                const impact = document.getElementById('impact').value;
                const difficulty = document.getElementById('difficulty').value;
                const time = document.getElementById('time').value;
                document.getElementById('score').value = calculateScore(asap, impact, difficulty, time);
            });
        });

        // Manejar el formulario
        document.getElementById('taskForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const task = {
        description: document.getElementById('description').value,
        asap: parseInt(document.getElementById('asap').value),
        impact: parseInt(document.getElementById('impact').value),
        difficulty: parseInt(document.getElementById('difficulty').value),
        time: parseInt(document.getElementById('time').value),
        score: parseInt(document.getElementById('score').value) || 0,
        status: 'No Realizado'
    };
    if (task.score === 0) {
        alert('Por favor, selecciona valores para calcular el puntaje');
        return;
    }
    console.log('Enviando tarea:', { action: 'addTask', task });
    try {
        const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Cambiar a 'cors' si se hospeda en un servidor
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'addTask', task })
        });
        console.log('Respuesta del servidor:', response);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const result = await response.json();
        console.log('Resultado:', result);
        if (result.status === 'success') {
            tasks.push(task);
            renderTasks();
            document.getElementById('taskForm').reset();
            document.getElementById('score').value = '';
            document.getElementById('status').value = 'No Realizado';
        } else {
            alert('Error al guardar tarea: ' + result.message);
        }
    } catch (error) {
        console.error('Error en la conexi贸n:', error);
        alert('Error en la conexi贸n: ' + error.message);
    }
});
        // Cargar tareas
        async function loadTasks() {
            try {
                const response = await fetch(APPS_SCRIPT_URL);
                const result = await response.json();
                if (result.status === 'success') {
                    tasks = result.tasks;
                    renderTasks();
                } else {
                    alert('Error al cargar tareas: ' + result.message);
                }
            } catch (error) {
                alert('Error en la conexi贸n: ' + error.message);
            }
        }

        // Actualizar estatus
        async function updateTaskStatus(index, newStatus) {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'updateStatus', rowIndex: index, status: newStatus })
                });
                const result = await response.json();
                if (result.status === 'success') {
                    tasks[index].status = newStatus;
                    renderTasks();
                } else {
                    alert('Error al actualizar estatus: ' + result.message);
                }
            } catch (error) {
                alert('Error en la conexi贸n: ' + error.message);
            }
        }

        // Renderizar tareas
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            const pendingTasks = tasks
                .filter(task => task.status === 'No Realizado')
                .sort((a, b) => b.score - a.score);

            pendingTasks.forEach((task, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${task.description}</td>
                    <td>${task.asap}</td>
                    <td>${task.impact}</td>
                    <td>${task.difficulty}</td>
                    <td>${task.time}</td>
                    <td>${task.score}</td>
                    <td>${task.status}</td>
                    <td>
                        <button onclick="markAsDone(${tasks.indexOf(task)})">Marcar como Realizado</button>
                    </td>
                `;
                taskList.appendChild(row);
            });
        }

        // Marcar tarea como realizada
        function markAsDone(index) {
            updateTaskStatus(index, 'Realizado');
        }

        // Guardar cambios (opcional, ya que actualizamos en tiempo real)
        document.getElementById('saveChanges').addEventListener('click', () => {
            alert('Cambios guardados');
        });

        // Cargar tareas al iniciar
        loadTasks();
    </script>
</body>
</html>
